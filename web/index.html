<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Deep-Fried on Mobile</title>
    <meta name="viewport" content="viewport-fit=cover" />
    <meta
      http-equiv="Cross-Origin-Opener-Policy"
      content="same-origin-allow-popups"
    />
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="unsafe-none" />
    <link rel="stylesheet" href="./spaceui/SPACEUI.7.css" />
    <script type="module" src="./js/apps/menu.df.base.js"></script>
    <script type="module" src="./js/apps/welcome.df.js"></script>
    <script type="module" src="./js/shell.js"></script>

    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="re/ico/icon_top_32x.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="64x64"
      href="re/ico/icon_top_64x.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="128x128"
      href="re/ico/icon_top_128x.png"
    />
  </head>
  <body>
    <div class="app-container">
      <div class="app-list" id="appList">
        <div id="app-root"></div>
      </div>
    </div>

    <script>
      // Initialize the shell when DOM is loaded
      document.addEventListener("DOMContentLoaded", async function () {
        console.log("DOM loaded, initializing shell...");
        if (window.shell) {
          console.log("Shell found, loading all apps...");
          
          // Define all app names
          const appNames = ["welcome", "setting", "about"];
          
          try {
            // Load and initialize all apps
            await Promise.all(appNames.map(appName => 
              window.shell.loadApp(appName)
            ));
            
            console.log("All apps loaded, setting up initial view...");
            
            // Set all apps to layer_other
            const allApps = document.querySelectorAll('.window[id^="app-"]');
            allApps.forEach(app => {
              // Ensure all apps have the layer_other class
              app.classList.add('layer_other');
              // Make sure they're not active
              app.classList.remove('active');
              // Hide any apps that might be visible
              app.style.display = 'none';
              app.style.visibility = 'hidden';
              app.style.opacity = '0';
              app.style.pointerEvents = 'none';
            });
            
            // Show welcome app first
            await window.shell.showApp('welcome');
            
            // Log the state for debugging
            console.log("Current app:", window.shell.currentApp);
            console.log("Initialized apps:", Array.from(window.shell.initializedApps || []));
            
          } catch (error) {
            console.error("Error initializing apps:", error);
            // Even if there's an error, try to show welcome app if possible
            try {
              await window.shell.showApp('welcome');
            } catch (e) {
              console.error("Failed to show welcome app:", e);
            }
          }
        } else {
          console.error("Shell not found");
        }
      });
    </script>
  </body>
</html>
